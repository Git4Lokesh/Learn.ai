<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mastery Mode</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script>
    window.MathJax = {
      tex: {
        inlineMath: [ ['$', '$'], ['\\(', '\\)'], ['//', '//'] ],
        displayMath: [ ['$$', '$$'], ['\\[', '\\]'], ['\\\\', '\\\\'] ],
        processEscapes: true,
        processEnvironments: true,
        macros: { RR: '{\\mathbb{R}}', ZZ: '{\\mathbb{Z}}', NN: '{\\mathbb{N}}', QQ: '{\\mathbb{Q}}', CC: '{\\mathbb{C}}' }
      },
      options: { renderActions: { addMenu: [] } },
      startup: {
        ready: () => {
          MathJax.startup.defaultReady();
          MathJax.startup.promise.then(() => { console.log('MathJax initial typesetting complete'); });
        }
      }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
      .math-equation { 
        color: #F59E0B !important;
        font-weight: 500;
      }
      mjx-container[display="true"] { margin: 1em 0; text-align: center; }
      mjx-container[display="false"] { display: inline-block; margin: 0 0.1em; }
    </style>
</head>
<body class="bg-gradient-primary">
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="d-flex align-items-center justify-content-between mb-4">
                <a href="/" class="btn btn-outline-light">
                    <i class="bi bi-arrow-left me-2"></i> Back to Dashboard
                </a>
                <div class="text-end">
                    <span class="badge bg-light text-dark px-3 py-2">
                        <i class="bi bi-target me-2"></i> Mastery Mode (Adaptive)
                    </span>
                </div>
            </div>

            <div class="card border-0 shadow-lg rounded-4">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                        <h2 class="text-primary mb-0">Mastery Practice</h2>
                        <small class="text-muted">Answer questions until mastery â‰¥ 95%</small>
                    </div>
                    <% if (!topic || !gradeLevel) { %>
                        <form action="/master/start" method="POST" class="row g-3" enctype="multipart/form-data">
                            <div class="col-12">
                                <label class="form-label text-dark">
                                    <i class="bi bi-collection text-primary me-2"></i> Input Method
                                </label>
                                <div class="btn-group" role="group">
                                    <input type="radio" class="btn-check" name="inputMethod" id="masterInputTopic" value="topic" checked>
                                    <label class="btn btn-outline-primary" for="masterInputTopic"><i class="bi bi-keyboard me-1"></i> Topic</label>
                                    <input type="radio" class="btn-check" name="inputMethod" id="masterInputPdf" value="pdf">
                                    <label class="btn btn-outline-primary" for="masterInputPdf"><i class="bi bi-file-pdf me-1"></i> PDF</label>
                                </div>
                            </div>
                            <div class="col-md-6" id="masterTopicSection">
                                <label for="masterTopic" class="form-label text-dark">
                                    <i class="bi bi-bookmark-star text-primary me-2"></i> Topic
                                </label>
                                <input type="text" id="masterTopic" name="topic" class="form-control" placeholder="e.g., Algebra, Photosynthesis">
                                <div class="form-text"><small>Used as the skill for tracking mastery</small></div>
                            </div>
                            <div class="col-md-6">
                                <label for="masterLevel" class="form-label text-dark">
                                    <i class="bi bi-mortarboard text-primary me-2"></i> Grade Level
                                </label>
                                <input type="text" id="masterLevel" name="gradeLevel" class="form-control" placeholder="e.g., middle, high, college" required>
                                <div class="form-text"><small>Tailors wording and complexity</small></div>
                            </div>
                            <div class="col-12" id="masterPdfSection" style="display:none;">
                                <label class="form-label text-dark">
                                    <i class="bi bi-filetype-pdf text-primary me-2"></i> Upload PDF
                                </label>
                                <input type="file" class="form-control" name="document" accept=".pdf">
                                <div class="form-text"><small>Questions will be generated strictly from this content</small></div>
                            </div>
                            <div class="col-12 mt-2">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-play-fill me-1"></i> Start Mastery
                                </button>
                            </div>
                        </form>
                    <% } else if (completed) { %>
                        <div class="text-center">
                            <div class="display-5 text-success fw-bold mb-3">Mastered!</div>
                            <p class="text-white-50">Your mastery for <strong><%= topic %></strong> is above 95%.</p>
                            <a href="/master" class="btn btn-primary mt-3">Start Another Topic</a>
                        </div>
                    <% } else if (question) { %>
                        <div class="mb-3 d-flex flex-wrap align-items-center justify-content-between">
                            <div class="mb-2">
                                <div class="d-inline-flex align-items-center bg-light rounded-pill px-3 py-2">
                                    <span class="text-muted me-2">Topic:</span>
                                    <span class="badge bg-primary bg-opacity-10 text-primary px-3"><%= topic %></span>
                                    <span class="text-muted ms-3 me-2">Level:</span>
                                    <span class="badge bg-primary bg-opacity-10 text-primary px-3"><%= gradeLevel %></span>
                                </div>
                            </div>
                            <div class="w-100"></div>
                            <div class="mt-2 w-100">
                                <div class="d-flex align-items-center justify-content-between mb-1">
                                    <small class="text-muted">Mastery progress</small>
                                    <small class="text-muted"><%= Math.round((mastery || 0)*100) %>% / 95%</small>
                                </div>
                                <div class="progress" style="height: 10px;">
                                    <div class="progress-bar bg-success" role="progressbar" style="width: <%= Math.min(100, Math.round((mastery || 0)*100)) %>%" aria-valuemin="0" aria-valuemax="100"></div>
                                </div>
                            </div>
                        </div>

                        <% if (message) { %>
                            <div class="alert <%= message.startsWith('Correct') ? 'alert-success' : 'alert-warning' %> py-2">
                                <%= message %>
                            </div>
                        <% } %>

                        <h5 class="text-dark lh-base question-content mb-3"><%= question.question %></h5>
                        <form action="/master/answer" method="POST" class="mt-3">
                            <div class="list-group">
                                <label class="list-group-item">
                                    <input class="form-check-input me-2" type="radio" name="answer" value="option1" required>
                                    <span><%= question.option1 %></span>
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-2" type="radio" name="answer" value="option2" required>
                                    <span><%= question.option2 %></span>
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-2" type="radio" name="answer" value="option3" required>
                                    <span><%= question.option3 %></span>
                                </label>
                                <label class="list-group-item">
                                    <input class="form-check-input me-2" type="radio" name="answer" value="option4" required>
                                    <span><%= question.option4 %></span>
                                </label>
                            </div>
                            <div class="mt-3">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-send me-2"></i> Submit & Next
                                </button>
                            </div>
                        </form>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const inputTopic = document.getElementById('masterInputTopic');
  const inputPdf = document.getElementById('masterInputPdf');
  const topicSection = document.getElementById('masterTopicSection');
  const pdfSection = document.getElementById('masterPdfSection');
  const topicInput = document.getElementById('masterTopic');

  function toggleSections() {
    if (inputPdf && inputPdf.checked) {
      pdfSection.style.display = 'block';
      topicSection.style.display = 'none';
      if (topicInput) topicInput.required = false;
    } else {
      pdfSection.style.display = 'none';
      topicSection.style.display = 'block';
      if (topicInput) topicInput.required = true;
    }
  }
  if (inputTopic) inputTopic.addEventListener('change', toggleSections);        
  if (inputPdf) inputPdf.addEventListener('change', toggleSections);
  toggleSections();
});
</script>
<script src="/js/translator.js"></script>
</body>
</html>
